<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>stlile_sample</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@stlite/browser@0.95.0/build/stlite.css"
    />
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
import { mount } from "https://cdn.jsdelivr.net/npm/@stlite/browser@0.95.0/build/stlite.js"
mount(
  {
    
    streamlitConfig : {'client.toolbarMode': 'viewer'},
    requirements: ['streamlit', 'pandas', 'numpy', 'pydeck'],
    entrypoint: "stlite_sample.py",
    
    pyodideUrl: "https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js",
    files: {
"stlite_sample.py": `
import streamlit as st
import pandas as pd
import numpy as np
import pydeck as pdk

# ãƒšãƒ¼ã‚¸ã®è¨­å®š
st.set_page_config(page_title="stlite 3D Map & Table", page_icon="ğŸ“Š", layout="wide")

st.title("ğŸ“Š stlite ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ãƒ‡ãƒ¢")
st.write("3Dåœ°å›³ã§ã®ãƒ—ãƒ­ãƒƒãƒˆã¨ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆãƒ»ä½µç”¨ã§ãã¾ã™ã€‚")

# 1. ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
@st.cache_data
def get_data(num_points):
    base_lat, base_lon = 35.6812, 139.7671
    df = pd.DataFrame({
        'åœ°ç‚¹å': [f"Point {i}" for i in range(num_points)],
        'lat': base_lat + np.random.randn(num_points) * 0.01,
        'lon': base_lon + np.random.randn(num_points) * 0.01,
        'æ•°å€¤ãƒ‡ãƒ¼ã‚¿': np.random.randint(100, 1000, num_points)
    })
    return df

# ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®è¨­å®š
st.sidebar.header("è¨­å®š")
num_points = st.sidebar.slider("ãƒ‡ãƒ¼ã‚¿æ•°", 50, 1000, 300)
data = get_data(num_points)

# 2. ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆã‚¿ãƒ–ã§è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆï¼‰
tab1, tab2 = st.tabs(["ğŸ™ï¸ 3Dåœ°å›³è¡¨ç¤º", "ğŸ“‘ ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«"])

with tab1:
    st.subheader("3D Column Map")
    
    view_state = pdk.ViewState(
        latitude=35.6812,
        longitude=139.7671,
        zoom=13,
        pitch=50,
    )

    layer = pdk.Layer(
        "ColumnLayer",
        data=data,
        get_position="[lon, lat]",
        get_elevation="æ•°å€¤ãƒ‡ãƒ¼ã‚¿",
        elevation_scale=0.5,
        radius=25,
        get_fill_color="[æ•°å€¤ãƒ‡ãƒ¼ã‚¿ * 0.2, 120, 200, 160]",
        pickable=True,
        auto_highlight=True,
    )

    st.pydeck_chart(pdk.Deck(
        layers=[layer],
        initial_view_state=view_state,
        tooltip={"text": "{åœ°ç‚¹å}\\næ•°å€¤: {æ•°å€¤ãƒ‡ãƒ¼ã‚¿}"}
    ))

with tab2:
    st.subheader("Raw Data Table")
    st.write("è¡¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚½ãƒ¼ãƒˆãŒå¯èƒ½ã§ã™ã€‚")

    # st.dataframe ã§è¡¨ã‚’è¡¨ç¤º
    # use_container_width=True ã§ç”»é¢å¹…ã„ã£ã±ã„ã«åºƒã’ã‚‹
    st.dataframe(
        data,
        column_order=("åœ°ç‚¹å", "æ•°å€¤ãƒ‡ãƒ¼ã‚¿", "lat", "lon")
    )

# 3. çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤ºï¼ˆãŠã¾ã‘ï¼‰
st.sidebar.markdown("---")
st.sidebar.subheader("çµ±è¨ˆ")
st.sidebar.metric("ãƒ‡ãƒ¼ã‚¿ã®åˆè¨ˆ", f"{data['æ•°å€¤ãƒ‡ãƒ¼ã‚¿'].sum():,}")
st.sidebar.metric("æœ€å¤§å€¤", f"{data['æ•°å€¤ãƒ‡ãƒ¼ã‚¿'].max()}")

`,

},
  },
  document.getElementById("root")
)

function Ou(n){const i=window.atob(n),a=i.length,l=new Uint8Array(a);for(let u=0;u<a;u++)l[u]=i.charCodeAt(u);return l}
    </script>
  </body>
  <!-- We love stlite! https://github.com/whitphx/stlite and Pyodide https://github.com/pyodide/pyodide -->
</html>